diff --git a/.gitignore b/.gitignore
index b6e4761..8c1fec8 100644
--- a/.gitignore
+++ b/.gitignore
@@ -127,3 +127,8 @@ dmypy.json
 
 # Pyre type checker
 .pyre/
+
+/data/train/*.tif
+/data/test/*.tif
+*.tif
+*/*.tif
\ No newline at end of file
diff --git a/notebooks/2.UNET.ipynb b/notebooks/2.UNET.ipynb
index 75108e7..a4959df 100644
--- a/notebooks/2.UNET.ipynb
+++ b/notebooks/2.UNET.ipynb
@@ -1 +1 @@
-{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"mount_file_id":"1V81sVJBqu03xCr6FdN3g89QQCIYNAtm6","authorship_tag":"ABX9TyNQJltguShoX/cVZ9uXzExO"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"}},"cells":[{"cell_type":"code","execution_count":1,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"id":"NAYGNHVMzY8G","executionInfo":{"status":"ok","timestamp":1673944337314,"user_tz":480,"elapsed":299718,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"6748e5b5-6d7a-4af5-d22e-7bef9ebe8fd3"},"outputs":[{"output_type":"stream","name":"stdout","text":["--2023-01-17 08:27:18--  https://zenodo.org/record/5610000/files/resnet50-sentinel2.pt\n","Resolving zenodo.org (zenodo.org)... 188.185.124.72\n","Connecting to zenodo.org (zenodo.org)|188.185.124.72|:443... connected.\n","HTTP request sent, awaiting response... 200 OK\n","Length: 94566017 (90M) [application/octet-stream]\n","Saving to: ‘resnet50-sentinel2.pt’\n","\n","resnet50-sentinel2. 100%[===================>]  90.18M   536KB/s    in 2m 59s  \n","\n","2023-01-17 08:30:24 (517 KB/s) - ‘resnet50-sentinel2.pt’ saved [94566017/94566017]\n","\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting rasterio\n","  Downloading rasterio-1.3.4-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (20.9 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m20.9/20.9 MB\u001b[0m \u001b[31m51.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (3.2.2)\n","Collecting torchgeo\n","  Downloading torchgeo-0.3.1-py3-none-any.whl (279 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m279.1/279.1 KB\u001b[0m \u001b[31m26.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting wandb\n","  Downloading wandb-0.13.9-py2.py3-none-any.whl (2.0 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.0/2.0 MB\u001b[0m \u001b[31m71.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: attrs in /usr/local/lib/python3.8/dist-packages (from rasterio) (22.2.0)\n","Requirement already satisfied: click>=4.0 in /usr/local/lib/python3.8/dist-packages (from rasterio) (7.1.2)\n","Requirement already satisfied: certifi in /usr/local/lib/python3.8/dist-packages (from rasterio) (2022.12.7)\n","Collecting snuggs>=1.4.1\n","  Downloading snuggs-1.4.7-py3-none-any.whl (5.4 kB)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.8/dist-packages (from rasterio) (57.4.0)\n","Collecting click-plugins\n","  Downloading click_plugins-1.1.1-py2.py3-none-any.whl (7.5 kB)\n","Collecting affine\n","  Downloading affine-2.3.1-py2.py3-none-any.whl (16 kB)\n","Collecting cligj>=0.5\n","  Downloading cligj-0.7.2-py3-none-any.whl (7.1 kB)\n","Requirement already satisfied: numpy>=1.18 in /usr/local/lib/python3.8/dist-packages (from rasterio) (1.21.6)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (1.4.4)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (3.0.9)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (2.8.2)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (0.11.0)\n","Collecting torchvision<0.14,>=0.10\n","  Downloading torchvision-0.13.1-cp38-cp38-manylinux1_x86_64.whl (19.1 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m19.1/19.1 MB\u001b[0m \u001b[31m66.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting rtree<2,>=1\n","  Downloading Rtree-1.0.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.0 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m1.0/1.0 MB\u001b[0m \u001b[31m53.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting omegaconf<3,>=2.1\n","  Downloading omegaconf-2.3.0-py3-none-any.whl (79 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m79.5/79.5 KB\u001b[0m \u001b[31m8.0 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting fiona<2,>=1.8\n","  Downloading Fiona-1.8.22-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (16.6 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m16.6/16.6 MB\u001b[0m \u001b[31m72.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pyproj<4,>=2.2\n","  Downloading pyproj-3.4.1-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (7.8 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m7.8/7.8 MB\u001b[0m \u001b[31m96.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: torch<2,>=1.9 in /usr/local/lib/python3.8/dist-packages (from torchgeo) (1.13.0+cu116)\n","Collecting timm<0.5,>=0.4.12\n","  Downloading timm-0.4.12-py3-none-any.whl (376 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m377.0/377.0 KB\u001b[0m \u001b[31m31.8 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting matplotlib\n","  Downloading matplotlib-3.6.3-cp38-cp38-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (9.4 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m9.4/9.4 MB\u001b[0m \u001b[31m92.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting einops<0.5,>=0.3\n","  Downloading einops-0.4.1-py3-none-any.whl (28 kB)\n","Collecting shapely<2,>=1.3\n","  Downloading Shapely-1.8.5.post1-cp38-cp38-manylinux_2_12_x86_64.manylinux2010_x86_64.whl (2.1 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m2.1/2.1 MB\u001b[0m \u001b[31m76.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: scikit-learn<2,>=0.21 in /usr/local/lib/python3.8/dist-packages (from torchgeo) (1.0.2)\n","Collecting kornia<0.7,>=0.6.4\n","  Downloading kornia-0.6.9-py2.py3-none-any.whl (569 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m569.1/569.1 KB\u001b[0m \u001b[31m39.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: pillow<10,>=6.2 in /usr/local/lib/python3.8/dist-packages (from torchgeo) (7.1.2)\n","Collecting torchmetrics<0.10,>=0.7\n","  Downloading torchmetrics-0.9.3-py3-none-any.whl (419 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m419.6/419.6 KB\u001b[0m \u001b[31m39.4 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pytorch-lightning<2,>=1.5.1\n","  Downloading pytorch_lightning-1.8.6-py3-none-any.whl (800 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m800.3/800.3 KB\u001b[0m \u001b[31m2.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting segmentation-models-pytorch<0.4,>=0.2\n","  Downloading segmentation_models_pytorch-0.3.2-py3-none-any.whl (106 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m106.7/106.7 KB\u001b[0m \u001b[31m9.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: packaging<22,>=17 in /usr/local/lib/python3.8/dist-packages (from torchgeo) (21.3)\n","Collecting fonttools>=4.22.0\n","  Downloading fonttools-4.38.0-py3-none-any.whl (965 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m965.4/965.4 KB\u001b[0m \u001b[31m27.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting contourpy>=1.0.1\n","  Downloading contourpy-1.0.7-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (300 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m300.0/300.0 KB\u001b[0m \u001b[31m17.3 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting GitPython>=1.0.0\n","  Downloading GitPython-3.1.30-py3-none-any.whl (184 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m184.0/184.0 KB\u001b[0m \u001b[31m13.7 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: protobuf!=4.21.0,<5,>=3.12.0 in /usr/local/lib/python3.8/dist-packages (from wandb) (3.19.6)\n","Collecting pathtools\n","  Downloading pathtools-0.1.2.tar.gz (11 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Requirement already satisfied: PyYAML in /usr/local/lib/python3.8/dist-packages (from wandb) (6.0)\n","Collecting sentry-sdk>=1.0.0\n","  Downloading sentry_sdk-1.13.0-py2.py3-none-any.whl (177 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m177.4/177.4 KB\u001b[0m \u001b[31m14.5 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting docker-pycreds>=0.4.0\n","  Downloading docker_pycreds-0.4.0-py2.py3-none-any.whl (9.0 kB)\n","Requirement already satisfied: requests<3,>=2.0.0 in /usr/local/lib/python3.8/dist-packages (from wandb) (2.25.1)\n","Requirement already satisfied: psutil>=5.0.0 in /usr/local/lib/python3.8/dist-packages (from wandb) (5.4.8)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.8/dist-packages (from wandb) (4.4.0)\n","Collecting setproctitle\n","  Downloading setproctitle-1.3.2-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (31 kB)\n","Requirement already satisfied: appdirs>=1.4.3 in /usr/local/lib/python3.8/dist-packages (from wandb) (1.4.4)\n","Requirement already satisfied: six>=1.4.0 in /usr/local/lib/python3.8/dist-packages (from docker-pycreds>=0.4.0->wandb) (1.15.0)\n","Collecting munch\n","  Downloading munch-2.5.0-py2.py3-none-any.whl (10 kB)\n","Collecting gitdb<5,>=4.0.1\n","  Downloading gitdb-4.0.10-py3-none-any.whl (62 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m62.7/62.7 KB\u001b[0m \u001b[31m6.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting antlr4-python3-runtime==4.9.*\n","  Downloading antlr4-python3-runtime-4.9.3.tar.gz (117 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m117.0/117.0 KB\u001b[0m \u001b[31m6.6 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting tensorboardX>=2.2\n","  Downloading tensorboardX-2.5.1-py2.py3-none-any.whl (125 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m125.4/125.4 KB\u001b[0m \u001b[31m12.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: fsspec[http]>2021.06.0 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning<2,>=1.5.1->torchgeo) (2022.11.0)\n","Collecting lightning-utilities!=0.4.0,>=0.3.0\n","  Downloading lightning_utilities-0.5.0-py3-none-any.whl (18 kB)\n","Requirement already satisfied: tqdm>=4.57.0 in /usr/local/lib/python3.8/dist-packages (from pytorch-lightning<2,>=1.5.1->torchgeo) (4.64.1)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests<3,>=2.0.0->wandb) (2.10)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests<3,>=2.0.0->wandb) (4.0.0)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests<3,>=2.0.0->wandb) (1.24.3)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.8/dist-packages (from scikit-learn<2,>=0.21->torchgeo) (3.1.0)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.8/dist-packages (from scikit-learn<2,>=0.21->torchgeo) (1.2.0)\n","Requirement already satisfied: scipy>=1.1.0 in /usr/local/lib/python3.8/dist-packages (from scikit-learn<2,>=0.21->torchgeo) (1.7.3)\n","Collecting segmentation-models-pytorch<0.4,>=0.2\n","  Downloading segmentation_models_pytorch-0.3.1-py3-none-any.whl (102 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m102.1/102.1 KB\u001b[0m \u001b[31m8.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting pretrainedmodels==0.7.4\n","  Downloading pretrainedmodels-0.7.4.tar.gz (58 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m58.8/58.8 KB\u001b[0m \u001b[31m4.2 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting efficientnet-pytorch==0.7.1\n","  Downloading efficientnet_pytorch-0.7.1.tar.gz (21 kB)\n","  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n","Collecting urllib3<1.27,>=1.21.1\n","  Downloading urllib3-1.26.14-py2.py3-none-any.whl (140 kB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m140.6/140.6 KB\u001b[0m \u001b[31m12.1 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hCollecting torch<2,>=1.9\n","  Downloading torch-1.12.1-cp38-cp38-manylinux1_x86_64.whl (776.3 MB)\n","\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m776.3/776.3 MB\u001b[0m \u001b[31m1.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n","\u001b[?25hRequirement already satisfied: aiohttp!=4.0.0a0,!=4.0.0a1 in /usr/local/lib/python3.8/dist-packages (from fsspec[http]>2021.06.0->pytorch-lightning<2,>=1.5.1->torchgeo) (3.8.3)\n","Collecting smmap<6,>=3.0.1\n","  Downloading smmap-5.0.0-py3-none-any.whl (24 kB)\n","Requirement already satisfied: frozenlist>=1.1.1 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning<2,>=1.5.1->torchgeo) (1.3.3)\n","Requirement already satisfied: multidict<7.0,>=4.5 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning<2,>=1.5.1->torchgeo) (6.0.4)\n","Requirement already satisfied: charset-normalizer<3.0,>=2.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning<2,>=1.5.1->torchgeo) (2.1.1)\n","Requirement already satisfied: yarl<2.0,>=1.0 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning<2,>=1.5.1->torchgeo) (1.8.2)\n","Requirement already satisfied: async-timeout<5.0,>=4.0.0a3 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning<2,>=1.5.1->torchgeo) (4.0.2)\n","Requirement already satisfied: aiosignal>=1.1.2 in /usr/local/lib/python3.8/dist-packages (from aiohttp!=4.0.0a0,!=4.0.0a1->fsspec[http]>2021.06.0->pytorch-lightning<2,>=1.5.1->torchgeo) (1.3.1)\n","Building wheels for collected packages: antlr4-python3-runtime, efficientnet-pytorch, pretrainedmodels, pathtools\n","  Building wheel for antlr4-python3-runtime (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for antlr4-python3-runtime: filename=antlr4_python3_runtime-4.9.3-py3-none-any.whl size=144575 sha256=e1220c9b0c7aaa97cd55dd33e7385d7d1c7f50aa72fdb0f16911cb8138fe163a\n","  Stored in directory: /root/.cache/pip/wheels/b1/a3/c2/6df046c09459b73cc9bb6c4401b0be6c47048baf9a1617c485\n","  Building wheel for efficientnet-pytorch (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for efficientnet-pytorch: filename=efficientnet_pytorch-0.7.1-py3-none-any.whl size=16446 sha256=b6ee24f1232bbe14785b08909e690dbe14bf86fa98b0a2d0d47d2b9c627c94e0\n","  Stored in directory: /root/.cache/pip/wheels/84/b9/90/25a0195cf95fb5533db96f1c77ea3f296b7cc86ae8ae48e3dc\n","  Building wheel for pretrainedmodels (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for pretrainedmodels: filename=pretrainedmodels-0.7.4-py3-none-any.whl size=60966 sha256=ac02321b8257218ba6e7c0d51d9028052a46502e7ded4d90fd3c01ce78eb7e99\n","  Stored in directory: /root/.cache/pip/wheels/ed/fa/b9/5c82b59d905f95542a192b883c0cc0082407ea2f54beb2f9e6\n","  Building wheel for pathtools (setup.py) ... \u001b[?25l\u001b[?25hdone\n","  Created wheel for pathtools: filename=pathtools-0.1.2-py3-none-any.whl size=8806 sha256=ed60f61734ec2861d3e7544247b52d3e179d449d3c325e4125ad1d3c55a799a9\n","  Stored in directory: /root/.cache/pip/wheels/4c/8e/7e/72fbc243e1aeecae64a96875432e70d4e92f3d2d18123be004\n","Successfully built antlr4-python3-runtime efficientnet-pytorch pretrainedmodels pathtools\n","Installing collected packages: pathtools, einops, antlr4-python3-runtime, affine, urllib3, torch, tensorboardX, snuggs, smmap, shapely, setproctitle, rtree, pyproj, omegaconf, munch, fonttools, docker-pycreds, contourpy, cligj, click-plugins, torchmetrics, sentry-sdk, rasterio, matplotlib, lightning-utilities, kornia, gitdb, fiona, efficientnet-pytorch, torchvision, GitPython, wandb, timm, pytorch-lightning, pretrainedmodels, segmentation-models-pytorch, torchgeo\n","  Attempting uninstall: urllib3\n","    Found existing installation: urllib3 1.24.3\n","    Uninstalling urllib3-1.24.3:\n","      Successfully uninstalled urllib3-1.24.3\n","  Attempting uninstall: torch\n","    Found existing installation: torch 1.13.0+cu116\n","    Uninstalling torch-1.13.0+cu116:\n","      Successfully uninstalled torch-1.13.0+cu116\n","  Attempting uninstall: shapely\n","    Found existing installation: shapely 2.0.0\n","    Uninstalling shapely-2.0.0:\n","      Successfully uninstalled shapely-2.0.0\n","  Attempting uninstall: matplotlib\n","    Found existing installation: matplotlib 3.2.2\n","    Uninstalling matplotlib-3.2.2:\n","      Successfully uninstalled matplotlib-3.2.2\n","  Attempting uninstall: torchvision\n","    Found existing installation: torchvision 0.14.0+cu116\n","    Uninstalling torchvision-0.14.0+cu116:\n","      Successfully uninstalled torchvision-0.14.0+cu116\n","\u001b[31mERROR: pip's dependency resolver does not currently take into account all the packages that are installed. This behaviour is the source of the following dependency conflicts.\n","torchtext 0.14.0 requires torch==1.13.0, but you have torch 1.12.1 which is incompatible.\n","torchaudio 0.13.0+cu116 requires torch==1.13.0, but you have torch 1.12.1 which is incompatible.\u001b[0m\u001b[31m\n","\u001b[0mSuccessfully installed GitPython-3.1.30 affine-2.3.1 antlr4-python3-runtime-4.9.3 click-plugins-1.1.1 cligj-0.7.2 contourpy-1.0.7 docker-pycreds-0.4.0 efficientnet-pytorch-0.7.1 einops-0.4.1 fiona-1.8.22 fonttools-4.38.0 gitdb-4.0.10 kornia-0.6.9 lightning-utilities-0.5.0 matplotlib-3.6.3 munch-2.5.0 omegaconf-2.3.0 pathtools-0.1.2 pretrainedmodels-0.7.4 pyproj-3.4.1 pytorch-lightning-1.8.6 rasterio-1.3.4 rtree-1.0.1 segmentation-models-pytorch-0.3.1 sentry-sdk-1.13.0 setproctitle-1.3.2 shapely-1.8.5.post1 smmap-5.0.0 snuggs-1.4.7 tensorboardX-2.5.1 timm-0.4.12 torch-1.12.1 torchgeo-0.3.1 torchmetrics-0.9.3 torchvision-0.13.1 urllib3-1.26.14 wandb-0.13.9\n"]}],"source":["!wget https://zenodo.org/record/5610000/files/resnet50-sentinel2.pt\n","!pip install rasterio matplotlib torchgeo wandb"]},{"cell_type":"code","source":["def mount_bucket(bucket_name):\n","  \"\"\"\n","  This fn authenticates your google account and mounts to you Google Cloud Platform bucket\n","  \"\"\"\n","  !echo \"deb http://packages.cloud.google.com/apt gcsfuse-`lsb_release -c -s` main\" | sudo tee /etc/apt/sources.list.d/gcsfuse.list\n","  !curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n","  !sudo apt-get -y -q update\n","  !sudo apt-get -y -q install gcsfuse\n","\n","  from google.colab import auth\n","  auth.authenticate_user()\n","  !mkdir -p gcp_bucket \n","  !gcsfuse --implicit-dirs --limit-bytes-per-sec -1 --limit-ops-per-sec -1 {bucket_name} gcp_bucket\n","\n","mount_bucket('finlandforest')\n","%cd drive/MyDrive/finland_forest/"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"id":"hiX50hZ53oDF","executionInfo":{"status":"ok","timestamp":1673948594194,"user_tz":480,"elapsed":27575,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"9253863b-e098-4b06-f04c-a951a471df36"},"execution_count":15,"outputs":[{"output_type":"stream","name":"stdout","text":["deb http://packages.cloud.google.com/apt gcsfuse-bionic main\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1210  100  1210    0     0  30250      0 --:--:-- --:--:-- --:--:-- 30250\n","OK\n","Get:1 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]\n","Get:2 http://packages.cloud.google.com/apt gcsfuse-bionic InRelease [5,001 B]\n","Get:3 https://cloud.r-project.org/bin/linux/ubuntu bionic-cran40/ InRelease [3,626 B]\n","Hit:4 http://archive.ubuntu.com/ubuntu bionic InRelease\n","Ign:5 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  InRelease\n","Hit:6 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  InRelease\n","Hit:7 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  Release\n","Get:8 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]\n","Get:9 http://packages.cloud.google.com/apt gcsfuse-bionic/main amd64 Packages [1,799 B]\n","Get:10 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic InRelease [15.9 kB]\n","Get:11 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [83.3 kB]\n","Hit:12 http://ppa.launchpad.net/cran/libgit2/ubuntu bionic InRelease\n","Get:13 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [3,145 kB]\n","Hit:15 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu bionic InRelease\n","Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [1,412 kB]\n","Get:17 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,573 kB]\n","Hit:18 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu bionic InRelease\n","Get:19 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [1,371 kB]\n","Get:20 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3,568 kB]\n","Get:21 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main Sources [2,240 kB]\n","Get:22 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,351 kB]\n","Get:23 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main amd64 Packages [1,145 kB]\n","Fetched 17.1 MB in 3s (5,000 kB/s)\n","Reading package lists...\n","Reading package lists...\n","Building dependency tree...\n","Reading state information...\n","The following package was automatically installed and is no longer required:\n","  libnvidia-common-460\n","Use 'sudo apt autoremove' to remove it.\n","The following NEW packages will be installed:\n","  gcsfuse\n","0 upgraded, 1 newly installed, 0 to remove and 32 not upgraded.\n","Need to get 13.3 MB of archives.\n","After this operation, 30.7 MB of additional disk space will be used.\n","Get:1 http://packages.cloud.google.com/apt gcsfuse-bionic/main amd64 gcsfuse amd64 0.41.11 [13.3 MB]\n","Fetched 13.3 MB in 0s (66.2 MB/s)\n","debconf: unable to initialize frontend: Dialog\n","debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76, <> line 1.)\n","debconf: falling back to frontend: Readline\n","debconf: unable to initialize frontend: Readline\n","debconf: (This frontend requires a controlling tty.)\n","debconf: falling back to frontend: Teletype\n","dpkg-preconfigure: unable to re-open stdin: \n","Selecting previously unselected package gcsfuse.\n","(Reading database ... 124016 files and directories currently installed.)\n","Preparing to unpack .../gcsfuse_0.41.11_amd64.deb ...\n","Unpacking gcsfuse (0.41.11) ...\n","Setting up gcsfuse (0.41.11) ...\n","2023/01/17 09:43:14.192653 Start gcsfuse/0.41.11 (Go version go1.18.4) for app \"\" using mount point: /content/drive/MyDrive/finland_forest/gcp_bucket\n","2023/01/17 09:43:14.208297 Opening GCS connection...\n","2023/01/17 09:43:14.855044 Mounting file system \"finlandforest\"...\n","2023/01/17 09:43:14.858831 File system has been successfully mounted.\n","[Errno 2] No such file or directory: 'drive/MyDrive/finland_forest/'\n","/content/drive/MyDrive/finland_forest\n"]}]},{"cell_type":"code","source":["import torch\n","from torch.utils.data import Dataset, DataLoader\n","from torchvision.transforms import ToTensor\n","from torchvision.transforms import Compose, Normalize\n","import torch.nn.functional as F\n","import pandas as pd\n","import segmentation_models_pytorch as smp\n","import os\n","from torchvision.io import read_image\n","import rasterio\n","from pytorch_lightning import LightningModule, Trainer\n","from pytorch_lightning.loggers import WandbLogger\n","import pytorch_lightning as pl\n","import warnings\n","import numpy as np\n","from matplotlib import pyplot as plt\n","from PIL import Image\n","from tqdm.notebook import tqdm\n","import wandb\n","\n","from src.data_unet.data_loader import SentinelDataset2\n","\n","# Our rasters contain no geolocation info, so silence this warning from rasterio\n","warnings.filterwarnings(\"ignore\", category=rasterio.errors.NotGeoreferencedWarning)"],"metadata":{"id":"eraZew071vfF","executionInfo":{"status":"ok","timestamp":1673948853828,"user_tz":480,"elapsed":419,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}}},"execution_count":19,"outputs":[]},{"cell_type":"code","source":["features_metadata = \"/content/drive/MyDrive/finland_forest/data/features_metadata.csv\"\n","features_df = pd.read_csv(features_metadata)\n","img_dir = \"gcp_bucket/train_features\""],"metadata":{"id":"kMGXma_Z12Se","executionInfo":{"status":"ok","timestamp":1673948766508,"user_tz":480,"elapsed":2174,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}}},"execution_count":17,"outputs":[]},{"cell_type":"code","source":["train_dataset = SentinelDataset2(features_metadata, img_dir)\n","train_size = int(0.8*len(train_dataset))\n","valid_size = len(train_dataset) - train_size\n","train_set, val_set = torch.utils.data.random_split(train_dataset, [train_size, valid_size])\n","train_dataloader = DataLoader(train_set, batch_size=32, shuffle=True, num_workers = 6)\n","valid_dataloader = DataLoader(val_set, batch_size=32, shuffle=False, num_workers = 6)\n","\n","test_dataset = SentinelDataset2(features_metadata, img_dir, train=False)\n","test_dataloader = DataLoader(test_dataset, batch_size=32, shuffle=True, num_workers = 6)"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":272},"id":"u4jSINNL2peC","executionInfo":{"status":"error","timestamp":1673948917450,"user_tz":480,"elapsed":53658,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"30fb9833-bdfa-4ac5-f782-e97823707d53"},"execution_count":20,"outputs":[{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.8/dist-packages/torch/utils/data/dataloader.py:563: UserWarning: This DataLoader will create 6 worker processes in total. Our suggested max number of worker in current system is 2, which is smaller than what this DataLoader is going to create. Please be aware that excessive worker creation might get DataLoader running slow or even freeze, lower the worker number to avoid potential slowness/freeze if necessary.\n","  warnings.warn(_create_warning_msg(\n"]},{"output_type":"error","ename":"TypeError","evalue":"ignored","traceback":["\u001b[0;31m---------------------------------------------------------------------------\u001b[0m","\u001b[0;31mTypeError\u001b[0m                                 Traceback (most recent call last)","\u001b[0;32m<ipython-input-20-fcadf1726627>\u001b[0m in \u001b[0;36m<module>\u001b[0;34m\u001b[0m\n\u001b[1;32m      6\u001b[0m \u001b[0mvalid_dataloader\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mDataLoader\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mval_set\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mbatch_size\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m32\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mshuffle\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mFalse\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mnum_workers\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;36m6\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[1;32m      7\u001b[0m \u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0;32m----> 8\u001b[0;31m \u001b[0mtest_dataset\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mSentinelDataset2\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mfeatures_metadata\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mimg_dir\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mtrain\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mFalse\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n\u001b[0m\u001b[1;32m      9\u001b[0m \u001b[0mtest_dataloader\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0mDataLoader\u001b[0m\u001b[0;34m(\u001b[0m\u001b[0mtest_dataset\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mbatch_size\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;36m32\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mshuffle\u001b[0m\u001b[0;34m=\u001b[0m\u001b[0;32mTrue\u001b[0m\u001b[0;34m,\u001b[0m \u001b[0mnum_workers\u001b[0m \u001b[0;34m=\u001b[0m \u001b[0;36m6\u001b[0m\u001b[0;34m)\u001b[0m\u001b[0;34m\u001b[0m\u001b[0;34m\u001b[0m\u001b[0m\n","\u001b[0;31mTypeError\u001b[0m: __init__() got an unexpected keyword argument 'train'"]}]},{"cell_type":"code","source":["features_df"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"rheBIZSN2qGW","executionInfo":{"status":"ok","timestamp":1673946297953,"user_tz":480,"elapsed":196,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"61c78cce-7259-4fdb-ded3-9f398932c8cf"},"execution_count":9,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                  filename   chip_id satellite  split      month     size  \\\n","0       0003d2eb_S1_00.tif  0003d2eb        S1  train  September  1049524   \n","1       0003d2eb_S1_01.tif  0003d2eb        S1  train    October  1049524   \n","2       0003d2eb_S1_02.tif  0003d2eb        S1  train   November  1049524   \n","3       0003d2eb_S1_03.tif  0003d2eb        S1  train   December  1049524   \n","4       0003d2eb_S1_04.tif  0003d2eb        S1  train    January  1049524   \n","...                    ...       ...       ...    ...        ...      ...   \n","252421  fff812c0_S2_07.tif  fff812c0        S2   test      April  1443550   \n","252422  fff812c0_S2_08.tif  fff812c0        S2   test        May  1443550   \n","252423  fff812c0_S2_09.tif  fff812c0        S2   test       June  1443550   \n","252424  fff812c0_S2_10.tif  fff812c0        S2   test       July  1443550   \n","252425  fff812c0_S2_11.tif  fff812c0        S2   test     August  1443550   \n","\n","             cksum                                          s3path_us  \\\n","0       3953454613  s3://drivendata-competition-biomassters-public...   \n","1       3531005382  s3://drivendata-competition-biomassters-public...   \n","2       1401197002  s3://drivendata-competition-biomassters-public...   \n","3       3253084255  s3://drivendata-competition-biomassters-public...   \n","4       2467836265  s3://drivendata-competition-biomassters-public...   \n","...            ...                                                ...   \n","252421  2918693602  s3://drivendata-competition-biomassters-public...   \n","252422  2058531511  s3://drivendata-competition-biomassters-public...   \n","252423  3628104827  s3://drivendata-competition-biomassters-public...   \n","252424  4220479807  s3://drivendata-competition-biomassters-public...   \n","252425   845751377  s3://drivendata-competition-biomassters-public...   \n","\n","                                                s3path_eu  \\\n","0       s3://drivendata-competition-biomassters-public...   \n","1       s3://drivendata-competition-biomassters-public...   \n","2       s3://drivendata-competition-biomassters-public...   \n","3       s3://drivendata-competition-biomassters-public...   \n","4       s3://drivendata-competition-biomassters-public...   \n","...                                                   ...   \n","252421  s3://drivendata-competition-biomassters-public...   \n","252422  s3://drivendata-competition-biomassters-public...   \n","252423  s3://drivendata-competition-biomassters-public...   \n","252424  s3://drivendata-competition-biomassters-public...   \n","252425  s3://drivendata-competition-biomassters-public...   \n","\n","                                                s3path_as corresponding_agbm  \n","0       s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","1       s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","2       s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","3       s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","4       s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","...                                                   ...                ...  \n","252421  s3://drivendata-competition-biomassters-public...  fff812c0_agbm.tif  \n","252422  s3://drivendata-competition-biomassters-public...  fff812c0_agbm.tif  \n","252423  s3://drivendata-competition-biomassters-public...  fff812c0_agbm.tif  \n","252424  s3://drivendata-competition-biomassters-public...  fff812c0_agbm.tif  \n","252425  s3://drivendata-competition-biomassters-public...  fff812c0_agbm.tif  \n","\n","[252426 rows x 11 columns]"],"text/html":["\n","  <div id=\"df-f7fd1003-4e46-4fb9-a154-a686d7e4bed4\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>filename</th>\n","      <th>chip_id</th>\n","      <th>satellite</th>\n","      <th>split</th>\n","      <th>month</th>\n","      <th>size</th>\n","      <th>cksum</th>\n","      <th>s3path_us</th>\n","      <th>s3path_eu</th>\n","      <th>s3path_as</th>\n","      <th>corresponding_agbm</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0003d2eb_S1_00.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>September</td>\n","      <td>1049524</td>\n","      <td>3953454613</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0003d2eb_S1_01.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>October</td>\n","      <td>1049524</td>\n","      <td>3531005382</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0003d2eb_S1_02.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>November</td>\n","      <td>1049524</td>\n","      <td>1401197002</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>0003d2eb_S1_03.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>December</td>\n","      <td>1049524</td>\n","      <td>3253084255</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>0003d2eb_S1_04.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>January</td>\n","      <td>1049524</td>\n","      <td>2467836265</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>252421</th>\n","      <td>fff812c0_S2_07.tif</td>\n","      <td>fff812c0</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>April</td>\n","      <td>1443550</td>\n","      <td>2918693602</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>fff812c0_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252422</th>\n","      <td>fff812c0_S2_08.tif</td>\n","      <td>fff812c0</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>May</td>\n","      <td>1443550</td>\n","      <td>2058531511</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>fff812c0_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252423</th>\n","      <td>fff812c0_S2_09.tif</td>\n","      <td>fff812c0</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>June</td>\n","      <td>1443550</td>\n","      <td>3628104827</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>fff812c0_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252424</th>\n","      <td>fff812c0_S2_10.tif</td>\n","      <td>fff812c0</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>July</td>\n","      <td>1443550</td>\n","      <td>4220479807</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>fff812c0_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252425</th>\n","      <td>fff812c0_S2_11.tif</td>\n","      <td>fff812c0</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>August</td>\n","      <td>1443550</td>\n","      <td>845751377</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>fff812c0_agbm.tif</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>252426 rows × 11 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f7fd1003-4e46-4fb9-a154-a686d7e4bed4')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-f7fd1003-4e46-4fb9-a154-a686d7e4bed4 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-f7fd1003-4e46-4fb9-a154-a686d7e4bed4');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":9}]},{"cell_type":"code","source":["features_df[features_df['chip_id'] == '0003d2eb']"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"id":"BxkXyzxl3hqm","executionInfo":{"status":"ok","timestamp":1673944928331,"user_tz":480,"elapsed":190,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"68a3931f-05a2-4a36-9d88-1693c6139a10"},"execution_count":8,"outputs":[{"output_type":"execute_result","data":{"text/plain":["              filename   chip_id satellite  split      month     size  \\\n","0   0003d2eb_S1_00.tif  0003d2eb        S1  train  September  1049524   \n","1   0003d2eb_S1_01.tif  0003d2eb        S1  train    October  1049524   \n","2   0003d2eb_S1_02.tif  0003d2eb        S1  train   November  1049524   \n","3   0003d2eb_S1_03.tif  0003d2eb        S1  train   December  1049524   \n","4   0003d2eb_S1_04.tif  0003d2eb        S1  train    January  1049524   \n","5   0003d2eb_S1_05.tif  0003d2eb        S1  train   February  1049524   \n","6   0003d2eb_S1_06.tif  0003d2eb        S1  train      March  1049524   \n","7   0003d2eb_S1_07.tif  0003d2eb        S1  train      April  1049524   \n","8   0003d2eb_S1_08.tif  0003d2eb        S1  train        May  1049524   \n","9   0003d2eb_S1_09.tif  0003d2eb        S1  train       June  1049524   \n","10  0003d2eb_S1_10.tif  0003d2eb        S1  train       July  1049524   \n","11  0003d2eb_S1_11.tif  0003d2eb        S1  train     August  1049524   \n","12  0003d2eb_S2_00.tif  0003d2eb        S2  train  September  1443550   \n","13  0003d2eb_S2_01.tif  0003d2eb        S2  train    October  1443550   \n","14  0003d2eb_S2_05.tif  0003d2eb        S2  train   February  1443550   \n","15  0003d2eb_S2_06.tif  0003d2eb        S2  train      March  1443550   \n","16  0003d2eb_S2_07.tif  0003d2eb        S2  train      April  1443550   \n","17  0003d2eb_S2_08.tif  0003d2eb        S2  train        May  1443550   \n","18  0003d2eb_S2_09.tif  0003d2eb        S2  train       June  1443550   \n","19  0003d2eb_S2_10.tif  0003d2eb        S2  train       July  1443550   \n","20  0003d2eb_S2_11.tif  0003d2eb        S2  train     August  1443550   \n","\n","         cksum                                          s3path_us  \\\n","0   3953454613  s3://drivendata-competition-biomassters-public...   \n","1   3531005382  s3://drivendata-competition-biomassters-public...   \n","2   1401197002  s3://drivendata-competition-biomassters-public...   \n","3   3253084255  s3://drivendata-competition-biomassters-public...   \n","4   2467836265  s3://drivendata-competition-biomassters-public...   \n","5   2955837881  s3://drivendata-competition-biomassters-public...   \n","6    938913233  s3://drivendata-competition-biomassters-public...   \n","7    225964894  s3://drivendata-competition-biomassters-public...   \n","8    135181958  s3://drivendata-competition-biomassters-public...   \n","9   2451157738  s3://drivendata-competition-biomassters-public...   \n","10  1139004820  s3://drivendata-competition-biomassters-public...   \n","11  1895782794  s3://drivendata-competition-biomassters-public...   \n","12  3291240031  s3://drivendata-competition-biomassters-public...   \n","13  1582104850  s3://drivendata-competition-biomassters-public...   \n","14   112844356  s3://drivendata-competition-biomassters-public...   \n","15  3530580357  s3://drivendata-competition-biomassters-public...   \n","16  4073427744  s3://drivendata-competition-biomassters-public...   \n","17  2432198769  s3://drivendata-competition-biomassters-public...   \n","18  3132179365  s3://drivendata-competition-biomassters-public...   \n","19    94274541  s3://drivendata-competition-biomassters-public...   \n","20  3822278950  s3://drivendata-competition-biomassters-public...   \n","\n","                                            s3path_eu  \\\n","0   s3://drivendata-competition-biomassters-public...   \n","1   s3://drivendata-competition-biomassters-public...   \n","2   s3://drivendata-competition-biomassters-public...   \n","3   s3://drivendata-competition-biomassters-public...   \n","4   s3://drivendata-competition-biomassters-public...   \n","5   s3://drivendata-competition-biomassters-public...   \n","6   s3://drivendata-competition-biomassters-public...   \n","7   s3://drivendata-competition-biomassters-public...   \n","8   s3://drivendata-competition-biomassters-public...   \n","9   s3://drivendata-competition-biomassters-public...   \n","10  s3://drivendata-competition-biomassters-public...   \n","11  s3://drivendata-competition-biomassters-public...   \n","12  s3://drivendata-competition-biomassters-public...   \n","13  s3://drivendata-competition-biomassters-public...   \n","14  s3://drivendata-competition-biomassters-public...   \n","15  s3://drivendata-competition-biomassters-public...   \n","16  s3://drivendata-competition-biomassters-public...   \n","17  s3://drivendata-competition-biomassters-public...   \n","18  s3://drivendata-competition-biomassters-public...   \n","19  s3://drivendata-competition-biomassters-public...   \n","20  s3://drivendata-competition-biomassters-public...   \n","\n","                                            s3path_as corresponding_agbm  \n","0   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","1   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","2   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","3   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","4   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","5   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","6   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","7   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","8   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","9   s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","10  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","11  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","12  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","13  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","14  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","15  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","16  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","17  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","18  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","19  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  \n","20  s3://drivendata-competition-biomassters-public...  0003d2eb_agbm.tif  "],"text/html":["\n","  <div id=\"df-1d7eb8c1-2a57-493d-970c-80434225c5fc\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>filename</th>\n","      <th>chip_id</th>\n","      <th>satellite</th>\n","      <th>split</th>\n","      <th>month</th>\n","      <th>size</th>\n","      <th>cksum</th>\n","      <th>s3path_us</th>\n","      <th>s3path_eu</th>\n","      <th>s3path_as</th>\n","      <th>corresponding_agbm</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0003d2eb_S1_00.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>September</td>\n","      <td>1049524</td>\n","      <td>3953454613</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0003d2eb_S1_01.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>October</td>\n","      <td>1049524</td>\n","      <td>3531005382</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0003d2eb_S1_02.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>November</td>\n","      <td>1049524</td>\n","      <td>1401197002</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>0003d2eb_S1_03.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>December</td>\n","      <td>1049524</td>\n","      <td>3253084255</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>0003d2eb_S1_04.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>January</td>\n","      <td>1049524</td>\n","      <td>2467836265</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>5</th>\n","      <td>0003d2eb_S1_05.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>February</td>\n","      <td>1049524</td>\n","      <td>2955837881</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>6</th>\n","      <td>0003d2eb_S1_06.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>March</td>\n","      <td>1049524</td>\n","      <td>938913233</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>7</th>\n","      <td>0003d2eb_S1_07.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>April</td>\n","      <td>1049524</td>\n","      <td>225964894</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>8</th>\n","      <td>0003d2eb_S1_08.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>May</td>\n","      <td>1049524</td>\n","      <td>135181958</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>9</th>\n","      <td>0003d2eb_S1_09.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>June</td>\n","      <td>1049524</td>\n","      <td>2451157738</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>10</th>\n","      <td>0003d2eb_S1_10.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>July</td>\n","      <td>1049524</td>\n","      <td>1139004820</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>11</th>\n","      <td>0003d2eb_S1_11.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>August</td>\n","      <td>1049524</td>\n","      <td>1895782794</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>12</th>\n","      <td>0003d2eb_S2_00.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>September</td>\n","      <td>1443550</td>\n","      <td>3291240031</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>13</th>\n","      <td>0003d2eb_S2_01.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>October</td>\n","      <td>1443550</td>\n","      <td>1582104850</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>14</th>\n","      <td>0003d2eb_S2_05.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>February</td>\n","      <td>1443550</td>\n","      <td>112844356</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>15</th>\n","      <td>0003d2eb_S2_06.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>March</td>\n","      <td>1443550</td>\n","      <td>3530580357</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>16</th>\n","      <td>0003d2eb_S2_07.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>April</td>\n","      <td>1443550</td>\n","      <td>4073427744</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>17</th>\n","      <td>0003d2eb_S2_08.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>May</td>\n","      <td>1443550</td>\n","      <td>2432198769</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>18</th>\n","      <td>0003d2eb_S2_09.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>June</td>\n","      <td>1443550</td>\n","      <td>3132179365</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>19</th>\n","      <td>0003d2eb_S2_10.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>July</td>\n","      <td>1443550</td>\n","      <td>94274541</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>20</th>\n","      <td>0003d2eb_S2_11.tif</td>\n","      <td>0003d2eb</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>August</td>\n","      <td>1443550</td>\n","      <td>3822278950</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>s3://drivendata-competition-biomassters-public...</td>\n","      <td>0003d2eb_agbm.tif</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-1d7eb8c1-2a57-493d-970c-80434225c5fc')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-1d7eb8c1-2a57-493d-970c-80434225c5fc button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-1d7eb8c1-2a57-493d-970c-80434225c5fc');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":8}]},{"cell_type":"code","source":[],"metadata":{"id":"y4n74qTr422u"},"execution_count":null,"outputs":[]}]}
\ No newline at end of file
+{"cells":[{"cell_type":"code","execution_count":10,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"executionInfo":{"elapsed":299718,"status":"ok","timestamp":1673944337314,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"NAYGNHVMzY8G","outputId":"6748e5b5-6d7a-4af5-d22e-7bef9ebe8fd3"},"outputs":[{"name":"stdout","output_type":"stream","text":["--2023-01-21 00:17:15--  https://zenodo.org/record/5610000/files/resnet50-sentinel2.pt\n","Resolving zenodo.org (zenodo.org)... 188.185.124.72\n","Connecting to zenodo.org (zenodo.org)|188.185.124.72|:443... connected.\n","HTTP request sent, awaiting response... 200 OK\n","Length: 94566017 (90M) [application/octet-stream]\n","Saving to: ‘resnet50-sentinel2.pt’\n","\n","resnet50-sentinel2. 100%[===================>]  90.18M  14.3MB/s    in 25s     \n","\n","2023-01-21 00:17:42 (3.60 MB/s) - ‘resnet50-sentinel2.pt’ saved [94566017/94566017]\n","\n"]}],"source":["!wget https://zenodo.org/record/5610000/files/resnet50-sentinel2.pt\n","#!pip install rasterio matplotlib torchgeo wandb"]},{"cell_type":"code","execution_count":15,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"executionInfo":{"elapsed":27575,"status":"ok","timestamp":1673948594194,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"hiX50hZ53oDF","outputId":"9253863b-e098-4b06-f04c-a951a471df36"},"outputs":[{"name":"stdout","output_type":"stream","text":["deb http://packages.cloud.google.com/apt gcsfuse-bionic main\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1210  100  1210    0     0  30250      0 --:--:-- --:--:-- --:--:-- 30250\n","OK\n","Get:1 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]\n","Get:2 http://packages.cloud.google.com/apt gcsfuse-bionic InRelease [5,001 B]\n","Get:3 https://cloud.r-project.org/bin/linux/ubuntu bionic-cran40/ InRelease [3,626 B]\n","Hit:4 http://archive.ubuntu.com/ubuntu bionic InRelease\n","Ign:5 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  InRelease\n","Hit:6 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64  InRelease\n","Hit:7 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu1804/x86_64  Release\n","Get:8 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]\n","Get:9 http://packages.cloud.google.com/apt gcsfuse-bionic/main amd64 Packages [1,799 B]\n","Get:10 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic InRelease [15.9 kB]\n","Get:11 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [83.3 kB]\n","Hit:12 http://ppa.launchpad.net/cran/libgit2/ubuntu bionic InRelease\n","Get:13 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [3,145 kB]\n","Hit:15 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu bionic InRelease\n","Get:16 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [1,412 kB]\n","Get:17 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,573 kB]\n","Hit:18 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu bionic InRelease\n","Get:19 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [1,371 kB]\n","Get:20 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3,568 kB]\n","Get:21 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main Sources [2,240 kB]\n","Get:22 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,351 kB]\n","Get:23 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu bionic/main amd64 Packages [1,145 kB]\n","Fetched 17.1 MB in 3s (5,000 kB/s)\n","Reading package lists...\n","Reading package lists...\n","Building dependency tree...\n","Reading state information...\n","The following package was automatically installed and is no longer required:\n","  libnvidia-common-460\n","Use 'sudo apt autoremove' to remove it.\n","The following NEW packages will be installed:\n","  gcsfuse\n","0 upgraded, 1 newly installed, 0 to remove and 32 not upgraded.\n","Need to get 13.3 MB of archives.\n","After this operation, 30.7 MB of additional disk space will be used.\n","Get:1 http://packages.cloud.google.com/apt gcsfuse-bionic/main amd64 gcsfuse amd64 0.41.11 [13.3 MB]\n","Fetched 13.3 MB in 0s (66.2 MB/s)\n","debconf: unable to initialize frontend: Dialog\n","debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76, <> line 1.)\n","debconf: falling back to frontend: Readline\n","debconf: unable to initialize frontend: Readline\n","debconf: (This frontend requires a controlling tty.)\n","debconf: falling back to frontend: Teletype\n","dpkg-preconfigure: unable to re-open stdin: \n","Selecting previously unselected package gcsfuse.\n","(Reading database ... 124016 files and directories currently installed.)\n","Preparing to unpack .../gcsfuse_0.41.11_amd64.deb ...\n","Unpacking gcsfuse (0.41.11) ...\n","Setting up gcsfuse (0.41.11) ...\n","2023/01/17 09:43:14.192653 Start gcsfuse/0.41.11 (Go version go1.18.4) for app \"\" using mount point: /content/drive/MyDrive/finland_forest/gcp_bucket\n","2023/01/17 09:43:14.208297 Opening GCS connection...\n","2023/01/17 09:43:14.855044 Mounting file system \"finlandforest\"...\n","2023/01/17 09:43:14.858831 File system has been successfully mounted.\n","[Errno 2] No such file or directory: 'drive/MyDrive/finland_forest/'\n","/content/drive/MyDrive/finland_forest\n"]}],"source":["def mount_bucket(bucket_name):\n","  \"\"\"\n","  This fn authenticates your google account and mounts to you Google Cloud Platform bucket\n","  \"\"\"\n","  !echo \"deb http://packages.cloud.google.com/apt gcsfuse-`lsb_release -c -s` main\" | sudo tee /etc/apt/sources.list.d/gcsfuse.list\n","  !curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n","  !sudo apt-get -y -q update\n","  !sudo apt-get -y -q install gcsfuse\n","\n","  from google.colab import auth\n","  auth.authenticate_user()\n","  !mkdir -p gcp_bucket \n","  !gcsfuse --implicit-dirs --limit-bytes-per-sec -1 --limit-ops-per-sec -1 {bucket_name} gcp_bucket\n","\n","mount_bucket('finlandforest')\n","%cd drive/MyDrive/finland_forest/"]},{"cell_type":"code","execution_count":2,"metadata":{"executionInfo":{"elapsed":419,"status":"ok","timestamp":1673948853828,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"eraZew071vfF"},"outputs":[{"name":"stderr","output_type":"stream","text":["/opt/conda/envs/new/lib/python3.9/site-packages/tqdm/auto.py:22: TqdmWarning: IProgress not found. Please update jupyter and ipywidgets. See https://ipywidgets.readthedocs.io/en/stable/user_install.html\n","  from .autonotebook import tqdm as notebook_tqdm\n"]}],"source":["import torch\n","from torch.utils.data import Dataset, DataLoader\n","from torchvision.transforms import ToTensor\n","from torchvision.transforms import Compose, Normalize\n","import torch.nn.functional as F\n","import pandas as pd\n","import segmentation_models_pytorch as smp\n","import os\n","from torchvision.io import read_image\n","import rasterio\n","from pytorch_lightning import LightningModule, Trainer\n","from pytorch_lightning.loggers import WandbLogger\n","import pytorch_lightning as pl\n","import warnings\n","import numpy as np\n","from matplotlib import pyplot as plt\n","from PIL import Image\n","from tqdm.notebook import tqdm\n","import wandb\n","from pathlib import Path\n","#os.chdir('../')\n","#from src.data_unet.data_loader import SentinelDataset2\n","\n","# Our rasters contain no geolocation info, so silence this warning from rasterio\n","warnings.filterwarnings(\"ignore\", category=rasterio.errors.NotGeoreferencedWarning)"]},{"cell_type":"code","execution_count":3,"metadata":{"executionInfo":{"elapsed":2174,"status":"ok","timestamp":1673948766508,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"kMGXma_Z12Se"},"outputs":[],"source":["features_metadata = \"~/Desktop/DD-Finland-Forests/data/features_metadata.csv\"\n","features_df = pd.read_csv(features_metadata)\n","train_img_dir = \"../data/train/train_features/\"\n","test_img_dir = \"../data/test/\"\n","\n","label_dir = \"../data/train/train_agbm/\""]},{"cell_type":"code","execution_count":4,"metadata":{},"outputs":[],"source":["class SentinelDataset2(Dataset):\n","    def __init__(self, annotations_df, img_dir, label_dir=None, transform=None, target_transform=None):\n","        chips = annotations_df[annotations_df['satellite'] == 'S2']\n","        chips = chips[chips['split'] == 'train']\n","        self.chip_ids = chips[chips['filename'].apply(lambda x: str(x).split('_')[-1]).str.contains('06.tif')]['chip_id']\n","                                                                        \n","        #self.chip_ids = annotations_df.chip_id.unique()\n","        self.img_dir = img_dir\n","        self.label_dir = label_dir\n","        self.transform = transform\n","        self.target_transform = target_transform\n","\n","        # self.chip_ids = [\n","        #     x for x in self.chip_ids if f\"{x}_S2_06.tif\" in os.listdir(img_dir)\n","        # ]\n","        \n","\n","    def __len__(self):\n","        return len(self.chip_ids)\n","\n","    def __getitem__(self, idx):\n","        img_path = os.path.join(self.img_dir, f\"{self.chip_ids[idx]}_S2_06.tif\")\n","        image = torch.tensor(rasterio.open(img_path).read().astype(np.float32)[:10])\n","        # Normalize image with mean 0 and stddev 1. Add a little bit to div to avoid dividing by 0\n","        image = (image.permute(1,2,0) - image.mean(dim=(1,2)))/(image.std(dim=(1,2)) + 0.01)\n","        image = image.permute(2,0,1)\n","\n","\n","        label_path = os.path.join(self.label_dir, f\"{self.chip_ids[idx]}_agbm.tif\")\n","        label = torch.tensor(rasterio.open(label_path).read().astype(np.float32))\n","\n","\n","        if self.transform:\n","            image = self.transform(image)\n","\n","        return image, label"]},{"cell_type":"code","execution_count":5,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":272},"executionInfo":{"elapsed":53658,"status":"error","timestamp":1673948917450,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"u4jSINNL2peC","outputId":"30fb9833-bdfa-4ac5-f782-e97823707d53"},"outputs":[],"source":["train_dataset = SentinelDataset2(features_df, train_img_dir, label_dir)\n","train_size = int(0.8*len(train_dataset))\n","valid_size = len(train_dataset) - train_size\n","train_set, val_set = torch.utils.data.random_split(train_dataset, [train_size, valid_size])\n","train_dataloader = DataLoader(train_set, batch_size=32, shuffle=True, num_workers = 6)\n","valid_dataloader = DataLoader(val_set, batch_size=32, shuffle=False, num_workers = 6)\n","\n","test_dataset = SentinelDataset2(features_df, test_img_dir)\n","test_dataloader = DataLoader(test_dataset, batch_size=32, shuffle=True, num_workers = 6)"]},{"cell_type":"code","execution_count":6,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"executionInfo":{"elapsed":196,"status":"ok","timestamp":1673946297953,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"rheBIZSN2qGW","outputId":"61c78cce-7259-4fdb-ded3-9f398932c8cf"},"outputs":[],"source":["class Sentinel2Model(pl.LightningModule):\n","    def __init__(self, model):\n","        super().__init__()\n","        self.model = model\n","\n","    def training_step(self, batch, batch_idx):\n","        x, y = batch\n","        y_hat = self.model(x)\n","        loss = F.mse_loss(y_hat, y)\n","        self.log(\"train/loss\", loss)\n","        self.log(\"train/rmse\", torch.sqrt(loss))\n","        return loss\n","    \n","    def validation_step(self, batch, batch_idx):\n","        x, y = batch\n","        y_hat = self.model(x)\n","        loss = F.mse_loss(y_hat, y)\n","        self.log(\"valid/loss\", loss)\n","        self.log(\"valid/rmse\", torch.sqrt(loss))\n","        return loss\n","    \n","    def configure_optimizers(self):\n","        return torch.optim.Adam(self.parameters(), lr=0.02)\n","    \n","    def forward(self, x):\n","        return self.model(x)"]},{"cell_type":"code","execution_count":7,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":1000},"executionInfo":{"elapsed":190,"status":"ok","timestamp":1673944928331,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"BxkXyzxl3hqm","outputId":"68a3931f-05a2-4a36-9d88-1693c6139a10"},"outputs":[],"source":["base_model = smp.Unet(\n","    encoder_name=\"resnet50\",       \n","    in_channels=10,                 \n","    classes=1,                     \n",")"]},{"cell_type":"code","execution_count":8,"metadata":{"id":"y4n74qTr422u"},"outputs":[],"source":["base_model.encoder.load_state_dict(torch.load(\"../resnet50-sentinel2.pt\"))\n","s2_model = Sentinel2Model(base_model)"]},{"cell_type":"code","execution_count":9,"metadata":{},"outputs":[{"name":"stderr","output_type":"stream","text":["Failed to detect the name of this notebook, you can set it manually with the WANDB_NOTEBOOK_NAME environment variable to enable code saving.\n","\u001b[34m\u001b[1mwandb\u001b[0m: Logging into wandb.ai. (Learn how to deploy a W&B server locally: https://wandb.me/wandb-server)\n","\u001b[34m\u001b[1mwandb\u001b[0m: You can find your API key in your browser here: https://wandb.ai/authorize\n","\u001b[34m\u001b[1mwandb\u001b[0m: Paste an API key from your profile and hit enter, or press ctrl+c to quit:\u001b[34m\u001b[1mwandb\u001b[0m: Paste an API key from your profile and hit enter, or press ctrl+c to quit:\u001b[34m\u001b[1mwandb\u001b[0m: Appending key for api.wandb.ai to your netrc file: /home/broug/.netrc\n"]}],"source":["wandb_logger = WandbLogger(name='Sentinel_2_ResNet50',project='BioMassters_baseline')"]},{"cell_type":"code","execution_count":null,"metadata":{},"outputs":[],"source":[]}],"metadata":{"colab":{"authorship_tag":"ABX9TyNQJltguShoX/cVZ9uXzExO","mount_file_id":"1V81sVJBqu03xCr6FdN3g89QQCIYNAtm6","provenance":[]},"kernelspec":{"display_name":"new","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.15"},"vscode":{"interpreter":{"hash":"64b9008e3ac84f59fe598096ba753170ef56d87c6b7c898b3dc8f256c225a33d"}}},"nbformat":4,"nbformat_minor":0}
diff --git a/notebooks/3.TF-test.ipynb b/notebooks/3.TF-test.ipynb
index 151ae05..f3e7269 100644
--- a/notebooks/3.TF-test.ipynb
+++ b/notebooks/3.TF-test.ipynb
@@ -1 +1 @@
-{"nbformat":4,"nbformat_minor":0,"metadata":{"colab":{"provenance":[],"mount_file_id":"1GqO1WIMUoWs77H5ieZgRTPSs3tXn93_c","authorship_tag":"ABX9TyOQt2g3dc3OPXvsRYF4gZ/y"},"kernelspec":{"name":"python3","display_name":"Python 3"},"language_info":{"name":"python"}},"cells":[{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"id":"ENwwOS7HmIBL","executionInfo":{"status":"ok","timestamp":1673990443269,"user_tz":480,"elapsed":13460,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"73457bbd-b4fc-4729-ee99-54f4b35d5e60"},"outputs":[{"output_type":"stream","name":"stdout","text":["\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0mLooking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Collecting rasterio\n","  Using cached rasterio-1.3.4-cp38-cp38-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (20.9 MB)\n","Requirement already satisfied: matplotlib in /usr/local/lib/python3.8/dist-packages (3.2.2)\n","Collecting wandb\n","  Using cached wandb-0.13.9-py2.py3-none-any.whl (2.0 MB)\n","Requirement already satisfied: numpy>=1.18 in /usr/local/lib/python3.8/dist-packages (from rasterio) (1.21.6)\n","Requirement already satisfied: click>=4.0 in /usr/local/lib/python3.8/dist-packages (from rasterio) (7.1.2)\n","Collecting click-plugins\n","  Using cached click_plugins-1.1.1-py2.py3-none-any.whl (7.5 kB)\n","Requirement already satisfied: attrs in /usr/local/lib/python3.8/dist-packages (from rasterio) (22.2.0)\n","Requirement already satisfied: setuptools in /usr/local/lib/python3.8/dist-packages (from rasterio) (57.4.0)\n","Requirement already satisfied: affine in /usr/local/lib/python3.8/dist-packages (from rasterio) (2.3.1)\n","Collecting cligj>=0.5\n","  Using cached cligj-0.7.2-py3-none-any.whl (7.1 kB)\n","Collecting snuggs>=1.4.1\n","  Using cached snuggs-1.4.7-py3-none-any.whl (5.4 kB)\n","Requirement already satisfied: certifi in /usr/local/lib/python3.8/dist-packages (from rasterio) (2022.12.7)\n","Requirement already satisfied: python-dateutil>=2.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (2.8.2)\n","Requirement already satisfied: cycler>=0.10 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (0.11.0)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (1.4.4)\n","Requirement already satisfied: pyparsing!=2.0.4,!=2.1.2,!=2.1.6,>=2.0.1 in /usr/local/lib/python3.8/dist-packages (from matplotlib) (3.0.9)\n","Requirement already satisfied: typing-extensions in /usr/local/lib/python3.8/dist-packages (from wandb) (4.4.0)\n","Collecting docker-pycreds>=0.4.0\n","  Using cached docker_pycreds-0.4.0-py2.py3-none-any.whl (9.0 kB)\n","Requirement already satisfied: requests<3,>=2.0.0 in /usr/local/lib/python3.8/dist-packages (from wandb) (2.25.1)\n","Collecting GitPython>=1.0.0\n","  Using cached GitPython-3.1.30-py3-none-any.whl (184 kB)\n","Collecting setproctitle\n","  Using cached setproctitle-1.3.2-cp38-cp38-manylinux_2_5_x86_64.manylinux1_x86_64.manylinux_2_17_x86_64.manylinux2014_x86_64.whl (31 kB)\n","Requirement already satisfied: pathtools in /usr/local/lib/python3.8/dist-packages (from wandb) (0.1.2)\n","Requirement already satisfied: PyYAML in /usr/local/lib/python3.8/dist-packages (from wandb) (6.0)\n","Requirement already satisfied: psutil>=5.0.0 in /usr/local/lib/python3.8/dist-packages (from wandb) (5.4.8)\n","Collecting sentry-sdk>=1.0.0\n","  Using cached sentry_sdk-1.13.0-py2.py3-none-any.whl (177 kB)\n","Requirement already satisfied: protobuf!=4.21.0,<5,>=3.12.0 in /usr/local/lib/python3.8/dist-packages (from wandb) (3.19.6)\n","Requirement already satisfied: appdirs>=1.4.3 in /usr/local/lib/python3.8/dist-packages (from wandb) (1.4.4)\n","Requirement already satisfied: six>=1.4.0 in /usr/local/lib/python3.8/dist-packages (from docker-pycreds>=0.4.0->wandb) (1.15.0)\n","Collecting gitdb<5,>=4.0.1\n","  Using cached gitdb-4.0.10-py3-none-any.whl (62 kB)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /usr/local/lib/python3.8/dist-packages (from requests<3,>=2.0.0->wandb) (1.26.14)\n","Requirement already satisfied: chardet<5,>=3.0.2 in /usr/local/lib/python3.8/dist-packages (from requests<3,>=2.0.0->wandb) (4.0.0)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.8/dist-packages (from requests<3,>=2.0.0->wandb) (2.10)\n","Collecting smmap<6,>=3.0.1\n","  Using cached smmap-5.0.0-py3-none-any.whl (24 kB)\n","\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0mInstalling collected packages: snuggs, smmap, setproctitle, sentry-sdk, docker-pycreds, cligj, click-plugins, rasterio, gitdb, GitPython, wandb\n","\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0m\u001b[33mWARNING: Ignoring invalid distribution -orch (/usr/local/lib/python3.8/dist-packages)\u001b[0m\u001b[33m\n","\u001b[0mSuccessfully installed GitPython-3.1.30 click-plugins-1.1.1 cligj-0.7.2 docker-pycreds-0.4.0 gitdb-4.0.10 rasterio-1.3.4 sentry-sdk-1.13.0 setproctitle-1.3.2 smmap-5.0.0 snuggs-1.4.7 wandb-0.13.9\n"]}],"source":["!pip install rasterio matplotlib wandb"]},{"cell_type":"code","source":["def mount_bucket(bucket_name):\n","  \"\"\"\n","  This fn authenticates your google account and mounts to you Google Cloud Platform bucket\n","  \"\"\"\n","  !echo \"deb http://packages.cloud.google.com/apt gcsfuse-`lsb_release -c -s` main\" | sudo tee /etc/apt/sources.list.d/gcsfuse.list\n","  !curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n","  !sudo apt-get -y -q update\n","  !sudo apt-get -y -q install gcsfuse\n","\n","  from google.colab import auth\n","  auth.authenticate_user()\n","  !mkdir -p gcp_bucket \n","  !gcsfuse --implicit-dirs --limit-bytes-per-sec -1 --limit-ops-per-sec -1 {bucket_name} gcp_bucket\n","\n","mount_bucket('finlandforest')\n","%cd drive/MyDrive/finland_forest/"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"id":"-iQiK5kBmRxG","executionInfo":{"status":"ok","timestamp":1673990428507,"user_tz":480,"elapsed":34048,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"8537bd90-a6d8-4125-c471-f93890cd1aa4"},"execution_count":2,"outputs":[{"output_type":"stream","name":"stdout","text":["deb http://packages.cloud.google.com/apt gcsfuse-focal main\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1210  100  1210    0     0  50416      0 --:--:-- --:--:-- --:--:-- 50416\n","OK\n","Get:1 https://cloud.r-project.org/bin/linux/ubuntu focal-cran40/ InRelease [3,622 B]\n","Ign:2 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu2004/x86_64  InRelease\n","Get:3 http://packages.cloud.google.com/apt gcsfuse-focal InRelease [4,999 B]\n","Hit:4 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64  InRelease\n","Hit:5 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu2004/x86_64  Release\n","Get:6 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu focal InRelease [18.1 kB]\n","Get:7 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]\n","Get:8 http://packages.cloud.google.com/apt gcsfuse-focal/main amd64 Packages [1,799 B]\n","Hit:9 http://archive.ubuntu.com/ubuntu focal InRelease\n","Get:11 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\n","Hit:12 http://ppa.launchpad.net/cran/libgit2/ubuntu focal InRelease\n","Get:13 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu focal InRelease [18.1 kB]\n","Get:14 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [1,864 kB]\n","Get:15 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]\n","Get:16 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [1,989 kB]\n","Hit:17 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu focal InRelease\n","Get:18 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu focal/main Sources [2,374 kB]\n","Get:19 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [980 kB]\n","Get:20 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [2,425 kB]\n","Get:21 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2,899 kB]\n","Get:22 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1,281 kB]\n","Get:23 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu focal/main amd64 Packages [1,125 kB]\n","Get:24 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu focal/main amd64 Packages [29.5 kB]\n","Fetched 15.3 MB in 7s (2,263 kB/s)\n","Reading package lists...\n","Reading package lists...\n","Building dependency tree...\n","Reading state information...\n","The following NEW packages will be installed:\n","  gcsfuse\n","0 upgraded, 1 newly installed, 0 to remove and 28 not upgraded.\n","Need to get 13.3 MB of archives.\n","After this operation, 30.7 MB of additional disk space will be used.\n","Get:1 http://packages.cloud.google.com/apt gcsfuse-focal/main amd64 gcsfuse amd64 0.41.11 [13.3 MB]\n","Fetched 13.3 MB in 0s (49.4 MB/s)\n","debconf: unable to initialize frontend: Dialog\n","debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76, <> line 1.)\n","debconf: falling back to frontend: Readline\n","debconf: unable to initialize frontend: Readline\n","debconf: (This frontend requires a controlling tty.)\n","debconf: falling back to frontend: Teletype\n","dpkg-preconfigure: unable to re-open stdin: \n","Selecting previously unselected package gcsfuse.\n","(Reading database ... 129501 files and directories currently installed.)\n","Preparing to unpack .../gcsfuse_0.41.11_amd64.deb ...\n","Unpacking gcsfuse (0.41.11) ...\n","Setting up gcsfuse (0.41.11) ...\n","2023/01/17 21:20:28.727949 Start gcsfuse/0.41.11 (Go version go1.18.4) for app \"\" using mount point: /content/gcp_bucket\n","2023/01/17 21:20:28.744388 Opening GCS connection...\n","2023/01/17 21:20:30.192539 Mounting file system \"finlandforest\"...\n","2023/01/17 21:20:30.193437 File system has been successfully mounted.\n","/content/drive/MyDrive/finland_forest\n"]}]},{"cell_type":"code","source":["%load_ext autoreload\n","%autoreload 2\n","\n","%cd drive/MyDrive/finland_forest"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"VE9gv2I9mcCl","executionInfo":{"status":"ok","timestamp":1673990523892,"user_tz":480,"elapsed":325,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"d1dca1ef-6cf0-46ee-ece0-abc5266c4f5b"},"execution_count":1,"outputs":[{"output_type":"stream","name":"stdout","text":["/content/drive/MyDrive/finland_forest\n"]}]},{"cell_type":"code","source":["import numpy as np\n","import pandas as pd\n","import rasterio\n","import matplotlib.pyplot as plt\n","from sklearn.preprocessing import minmax_scale\n","from tqdm.notebook import tqdm\n","\n","import tensorflow as tf\n","from tensorflow import data\n","\n","import warnings\n","warnings.filterwarnings(\"ignore\", category=rasterio.errors.NotGeoreferencedWarning)  # our rasters are not georeferenced\n","warnings.filterwarnings('ignore', r'All-NaN (slice|axis) encountered')\n","\n","PATH = '/content/drive/MyDrive/finland_forest/'"],"metadata":{"id":"VkogjfkgmhEc","executionInfo":{"status":"ok","timestamp":1673990681258,"user_tz":480,"elapsed":5,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}}},"execution_count":3,"outputs":[]},{"cell_type":"code","source":["features = pd.read_csv(f'{PATH}data/features_proc.csv')\n","train_features = features[features['split'] == 'train']\n","test_features = features[features['split'] == 'test']"],"metadata":{"id":"7mkktIlsnGET","executionInfo":{"status":"ok","timestamp":1673991017102,"user_tz":480,"elapsed":1321,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}}},"execution_count":5,"outputs":[]},{"cell_type":"code","source":["rasterio.open('/content/gcp_bucket/train_features/93dd0d32_agbm.tif').read()"],"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"1hMlLoOSn90s","executionInfo":{"status":"ok","timestamp":1673991402806,"user_tz":480,"elapsed":85398,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"f8f8a762-5b0c-4373-f5ac-84e6566ebd5f"},"execution_count":14,"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([[[  0.  ,   0.  ,   0.  , ..., 169.72,  96.03,  25.2 ],\n","        [ 42.62,  80.79,  80.79, ...,  26.95,  47.67,  35.67],\n","        [ 42.62,  80.79,  80.79, ...,  26.95,  47.67,  35.67],\n","        ...,\n","        [  0.  ,   0.  ,   0.  , ...,   0.  ,   0.  ,   0.  ],\n","        [  0.  ,   0.  ,   0.  , ...,   0.  ,   0.  ,   0.  ],\n","        [  0.  ,   0.  ,   0.  , ...,   0.  ,   0.  ,   0.  ]]],\n","      dtype=float32)"]},"metadata":{},"execution_count":14}]},{"cell_type":"code","source":["features"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"id":"3AzvagkgpVtV","executionInfo":{"status":"ok","timestamp":1673991134444,"user_tz":480,"elapsed":372,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"a0b439a3-c87c-494d-a7da-fefef70a4c62"},"execution_count":7,"outputs":[{"output_type":"execute_result","data":{"text/plain":["                  filename   chip_id satellite  split  month  \\\n","0       93dd0d32_S2_07.tif  93dd0d32        S2  train      4   \n","1       832b55bd_S1_04.tif  832b55bd        S1  train      1   \n","2       a6d62d7f_S2_00.tif  a6d62d7f        S2   test      9   \n","3       a74d5ce1_S1_10.tif  a74d5ce1        S1  train      7   \n","4       404571ba_S1_04.tif  404571ba        S1  train      1   \n","...                    ...       ...       ...    ...    ...   \n","252421  d3e6581d_S1_11.tif  d3e6581d        S1   test      8   \n","252422  e7535960_S1_07.tif  e7535960        S1  train      4   \n","252423  25a25054_S2_08.tif  25a25054        S2  train      5   \n","252424  508cbf2e_S2_04.tif  508cbf2e        S2   test      1   \n","252425  d1f4c37d_S1_02.tif  d1f4c37d        S1   test     11   \n","\n","       corresponding_agbm                                image_filepath  \\\n","0       93dd0d32_agbm.tif  gcp_bucket/train_features/93dd0d32_S2_07.tif   \n","1       832b55bd_agbm.tif  gcp_bucket/train_features/832b55bd_S1_04.tif   \n","2       a6d62d7f_agbm.tif  gcp_bucket/train_features/a6d62d7f_S2_00.tif   \n","3       a74d5ce1_agbm.tif  gcp_bucket/train_features/a74d5ce1_S1_10.tif   \n","4       404571ba_agbm.tif  gcp_bucket/train_features/404571ba_S1_04.tif   \n","...                   ...                                           ...   \n","252421  d3e6581d_agbm.tif  gcp_bucket/train_features/d3e6581d_S1_11.tif   \n","252422  e7535960_agbm.tif  gcp_bucket/train_features/e7535960_S1_07.tif   \n","252423  25a25054_agbm.tif  gcp_bucket/train_features/25a25054_S2_08.tif   \n","252424  508cbf2e_agbm.tif  gcp_bucket/train_features/508cbf2e_S2_04.tif   \n","252425  d1f4c37d_agbm.tif  gcp_bucket/train_features/d1f4c37d_S1_02.tif   \n","\n","                                     label_filepath  \n","0       gcp_bucket/train_features/93dd0d32_agbm.tif  \n","1       gcp_bucket/train_features/832b55bd_agbm.tif  \n","2       gcp_bucket/train_features/a6d62d7f_agbm.tif  \n","3       gcp_bucket/train_features/a74d5ce1_agbm.tif  \n","4       gcp_bucket/train_features/404571ba_agbm.tif  \n","...                                             ...  \n","252421  gcp_bucket/train_features/d3e6581d_agbm.tif  \n","252422  gcp_bucket/train_features/e7535960_agbm.tif  \n","252423  gcp_bucket/train_features/25a25054_agbm.tif  \n","252424  gcp_bucket/train_features/508cbf2e_agbm.tif  \n","252425  gcp_bucket/train_features/d1f4c37d_agbm.tif  \n","\n","[252426 rows x 8 columns]"],"text/html":["\n","  <div id=\"df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>filename</th>\n","      <th>chip_id</th>\n","      <th>satellite</th>\n","      <th>split</th>\n","      <th>month</th>\n","      <th>corresponding_agbm</th>\n","      <th>image_filepath</th>\n","      <th>label_filepath</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>93dd0d32_S2_07.tif</td>\n","      <td>93dd0d32</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>4</td>\n","      <td>93dd0d32_agbm.tif</td>\n","      <td>gcp_bucket/train_features/93dd0d32_S2_07.tif</td>\n","      <td>gcp_bucket/train_features/93dd0d32_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>832b55bd_S1_04.tif</td>\n","      <td>832b55bd</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>1</td>\n","      <td>832b55bd_agbm.tif</td>\n","      <td>gcp_bucket/train_features/832b55bd_S1_04.tif</td>\n","      <td>gcp_bucket/train_features/832b55bd_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>a6d62d7f_S2_00.tif</td>\n","      <td>a6d62d7f</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>9</td>\n","      <td>a6d62d7f_agbm.tif</td>\n","      <td>gcp_bucket/train_features/a6d62d7f_S2_00.tif</td>\n","      <td>gcp_bucket/train_features/a6d62d7f_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>a74d5ce1_S1_10.tif</td>\n","      <td>a74d5ce1</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>7</td>\n","      <td>a74d5ce1_agbm.tif</td>\n","      <td>gcp_bucket/train_features/a74d5ce1_S1_10.tif</td>\n","      <td>gcp_bucket/train_features/a74d5ce1_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>404571ba_S1_04.tif</td>\n","      <td>404571ba</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>1</td>\n","      <td>404571ba_agbm.tif</td>\n","      <td>gcp_bucket/train_features/404571ba_S1_04.tif</td>\n","      <td>gcp_bucket/train_features/404571ba_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>252421</th>\n","      <td>d3e6581d_S1_11.tif</td>\n","      <td>d3e6581d</td>\n","      <td>S1</td>\n","      <td>test</td>\n","      <td>8</td>\n","      <td>d3e6581d_agbm.tif</td>\n","      <td>gcp_bucket/train_features/d3e6581d_S1_11.tif</td>\n","      <td>gcp_bucket/train_features/d3e6581d_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252422</th>\n","      <td>e7535960_S1_07.tif</td>\n","      <td>e7535960</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>4</td>\n","      <td>e7535960_agbm.tif</td>\n","      <td>gcp_bucket/train_features/e7535960_S1_07.tif</td>\n","      <td>gcp_bucket/train_features/e7535960_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252423</th>\n","      <td>25a25054_S2_08.tif</td>\n","      <td>25a25054</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>5</td>\n","      <td>25a25054_agbm.tif</td>\n","      <td>gcp_bucket/train_features/25a25054_S2_08.tif</td>\n","      <td>gcp_bucket/train_features/25a25054_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252424</th>\n","      <td>508cbf2e_S2_04.tif</td>\n","      <td>508cbf2e</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>1</td>\n","      <td>508cbf2e_agbm.tif</td>\n","      <td>gcp_bucket/train_features/508cbf2e_S2_04.tif</td>\n","      <td>gcp_bucket/train_features/508cbf2e_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252425</th>\n","      <td>d1f4c37d_S1_02.tif</td>\n","      <td>d1f4c37d</td>\n","      <td>S1</td>\n","      <td>test</td>\n","      <td>11</td>\n","      <td>d1f4c37d_agbm.tif</td>\n","      <td>gcp_bucket/train_features/d1f4c37d_S1_02.tif</td>\n","      <td>gcp_bucket/train_features/d1f4c37d_agbm.tif</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>252426 rows × 8 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":7}]},{"cell_type":"code","source":["%pwd"],"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":35},"id":"H-JFWKTJpZcr","executionInfo":{"status":"ok","timestamp":1673991138190,"user_tz":480,"elapsed":321,"user":{"displayName":"graham broughton","userId":"15728648374086258761"}},"outputId":"781536a8-3e05-4b2f-a109-e6a9befa2b9d"},"execution_count":8,"outputs":[{"output_type":"execute_result","data":{"text/plain":["'/content/drive/MyDrive/finland_forest'"],"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"}},"metadata":{},"execution_count":8}]},{"cell_type":"code","source":[],"metadata":{"id":"rmny5wCipaZc"},"execution_count":null,"outputs":[]}]}
\ No newline at end of file
+{"cells":[{"cell_type":"code","execution_count":4,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"executionInfo":{"elapsed":13460,"status":"ok","timestamp":1673990443269,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"ENwwOS7HmIBL","outputId":"73457bbd-b4fc-4729-ee99-54f4b35d5e60"},"outputs":[{"name":"stdout","output_type":"stream","text":["Requirement already satisfied: rasterio in /opt/conda/lib/python3.7/site-packages (1.2.10)\n","Requirement already satisfied: matplotlib in /opt/conda/lib/python3.7/site-packages (3.5.3)\n","Requirement already satisfied: wandb in /opt/conda/lib/python3.7/site-packages (0.13.9)\n","Requirement already satisfied: cligj>=0.5 in /opt/conda/lib/python3.7/site-packages (from rasterio) (0.7.2)\n","Requirement already satisfied: setuptools in /opt/conda/lib/python3.7/site-packages (from rasterio) (65.5.1)\n","Requirement already satisfied: snuggs>=1.4.1 in /opt/conda/lib/python3.7/site-packages (from rasterio) (1.4.7)\n","Requirement already satisfied: click-plugins in /opt/conda/lib/python3.7/site-packages (from rasterio) (1.1.1)\n","Requirement already satisfied: affine in /opt/conda/lib/python3.7/site-packages (from rasterio) (2.4.0)\n","Requirement already satisfied: certifi in /opt/conda/lib/python3.7/site-packages (from rasterio) (2022.12.7)\n","Requirement already satisfied: click>=4.0 in /opt/conda/lib/python3.7/site-packages (from rasterio) (8.1.3)\n","Requirement already satisfied: attrs in /opt/conda/lib/python3.7/site-packages (from rasterio) (22.1.0)\n","Requirement already satisfied: numpy in /opt/conda/lib/python3.7/site-packages (from rasterio) (1.21.6)\n","Requirement already satisfied: pyparsing>=2.2.1 in /opt/conda/lib/python3.7/site-packages (from matplotlib) (3.0.9)\n","Requirement already satisfied: cycler>=0.10 in /opt/conda/lib/python3.7/site-packages (from matplotlib) (0.11.0)\n","Requirement already satisfied: kiwisolver>=1.0.1 in /opt/conda/lib/python3.7/site-packages (from matplotlib) (1.4.4)\n","Requirement already satisfied: packaging>=20.0 in /opt/conda/lib/python3.7/site-packages (from matplotlib) (22.0)\n","Requirement already satisfied: fonttools>=4.22.0 in /opt/conda/lib/python3.7/site-packages (from matplotlib) (4.38.0)\n","Requirement already satisfied: pillow>=6.2.0 in /opt/conda/lib/python3.7/site-packages (from matplotlib) (9.3.0)\n","Requirement already satisfied: python-dateutil>=2.7 in /opt/conda/lib/python3.7/site-packages (from matplotlib) (2.8.2)\n","Requirement already satisfied: PyYAML in /home/broug/.local/lib/python3.7/site-packages (from wandb) (5.4.1)\n","Requirement already satisfied: GitPython>=1.0.0 in /opt/conda/lib/python3.7/site-packages (from wandb) (3.1.29)\n","Requirement already satisfied: requests<3,>=2.0.0 in /opt/conda/lib/python3.7/site-packages (from wandb) (2.28.1)\n","Requirement already satisfied: setproctitle in /opt/conda/lib/python3.7/site-packages (from wandb) (1.3.2)\n","Requirement already satisfied: typing-extensions in /home/broug/.local/lib/python3.7/site-packages (from wandb) (4.4.0)\n","Requirement already satisfied: appdirs>=1.4.3 in /opt/conda/lib/python3.7/site-packages (from wandb) (1.4.4)\n","Requirement already satisfied: protobuf!=4.21.0,<5,>=3.12.0 in /opt/conda/lib/python3.7/site-packages (from wandb) (3.19.6)\n","Requirement already satisfied: docker-pycreds>=0.4.0 in /opt/conda/lib/python3.7/site-packages (from wandb) (0.4.0)\n","Requirement already satisfied: pathtools in /opt/conda/lib/python3.7/site-packages (from wandb) (0.1.2)\n","Requirement already satisfied: sentry-sdk>=1.0.0 in /opt/conda/lib/python3.7/site-packages (from wandb) (1.13.0)\n","Requirement already satisfied: psutil>=5.0.0 in /opt/conda/lib/python3.7/site-packages (from wandb) (5.9.3)\n","Requirement already satisfied: importlib-metadata in /home/broug/.local/lib/python3.7/site-packages (from click>=4.0->rasterio) (4.2.0)\n","Requirement already satisfied: six>=1.4.0 in /opt/conda/lib/python3.7/site-packages (from docker-pycreds>=0.4.0->wandb) (1.16.0)\n","Requirement already satisfied: gitdb<5,>=4.0.1 in /opt/conda/lib/python3.7/site-packages (from GitPython>=1.0.0->wandb) (4.0.10)\n","Requirement already satisfied: urllib3<1.27,>=1.21.1 in /opt/conda/lib/python3.7/site-packages (from requests<3,>=2.0.0->wandb) (1.26.13)\n","Requirement already satisfied: charset-normalizer<3,>=2 in /opt/conda/lib/python3.7/site-packages (from requests<3,>=2.0.0->wandb) (2.1.1)\n","Requirement already satisfied: idna<4,>=2.5 in /opt/conda/lib/python3.7/site-packages (from requests<3,>=2.0.0->wandb) (3.4)\n","Requirement already satisfied: smmap<6,>=3.0.1 in /opt/conda/lib/python3.7/site-packages (from gitdb<5,>=4.0.1->GitPython>=1.0.0->wandb) (5.0.0)\n","Requirement already satisfied: zipp>=0.5 in /home/broug/.local/lib/python3.7/site-packages (from importlib-metadata->click>=4.0->rasterio) (3.11.0)\n","Note: you may need to restart the kernel to use updated packages.\n"]}],"source":["%conda install rasterio matplotlib wandb"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"collapsed":true,"executionInfo":{"elapsed":34048,"status":"ok","timestamp":1673990428507,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"-iQiK5kBmRxG","outputId":"8537bd90-a6d8-4125-c471-f93890cd1aa4"},"outputs":[{"name":"stdout","output_type":"stream","text":["deb http://packages.cloud.google.com/apt gcsfuse-focal main\n","  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\n","                                 Dload  Upload   Total   Spent    Left  Speed\n","100  1210  100  1210    0     0  50416      0 --:--:-- --:--:-- --:--:-- 50416\n","OK\n","Get:1 https://cloud.r-project.org/bin/linux/ubuntu focal-cran40/ InRelease [3,622 B]\n","Ign:2 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu2004/x86_64  InRelease\n","Get:3 http://packages.cloud.google.com/apt gcsfuse-focal InRelease [4,999 B]\n","Hit:4 https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2004/x86_64  InRelease\n","Hit:5 https://developer.download.nvidia.com/compute/machine-learning/repos/ubuntu2004/x86_64  Release\n","Get:6 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu focal InRelease [18.1 kB]\n","Get:7 http://security.ubuntu.com/ubuntu focal-security InRelease [114 kB]\n","Get:8 http://packages.cloud.google.com/apt gcsfuse-focal/main amd64 Packages [1,799 B]\n","Hit:9 http://archive.ubuntu.com/ubuntu focal InRelease\n","Get:11 http://archive.ubuntu.com/ubuntu focal-updates InRelease [114 kB]\n","Hit:12 http://ppa.launchpad.net/cran/libgit2/ubuntu focal InRelease\n","Get:13 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu focal InRelease [18.1 kB]\n","Get:14 http://security.ubuntu.com/ubuntu focal-security/restricted amd64 Packages [1,864 kB]\n","Get:15 http://archive.ubuntu.com/ubuntu focal-backports InRelease [108 kB]\n","Get:16 http://archive.ubuntu.com/ubuntu focal-updates/restricted amd64 Packages [1,989 kB]\n","Hit:17 http://ppa.launchpad.net/graphics-drivers/ppa/ubuntu focal InRelease\n","Get:18 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu focal/main Sources [2,374 kB]\n","Get:19 http://security.ubuntu.com/ubuntu focal-security/universe amd64 Packages [980 kB]\n","Get:20 http://security.ubuntu.com/ubuntu focal-security/main amd64 Packages [2,425 kB]\n","Get:21 http://archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages [2,899 kB]\n","Get:22 http://archive.ubuntu.com/ubuntu focal-updates/universe amd64 Packages [1,281 kB]\n","Get:23 http://ppa.launchpad.net/c2d4u.team/c2d4u4.0+/ubuntu focal/main amd64 Packages [1,125 kB]\n","Get:24 http://ppa.launchpad.net/deadsnakes/ppa/ubuntu focal/main amd64 Packages [29.5 kB]\n","Fetched 15.3 MB in 7s (2,263 kB/s)\n","Reading package lists...\n","Reading package lists...\n","Building dependency tree...\n","Reading state information...\n","The following NEW packages will be installed:\n","  gcsfuse\n","0 upgraded, 1 newly installed, 0 to remove and 28 not upgraded.\n","Need to get 13.3 MB of archives.\n","After this operation, 30.7 MB of additional disk space will be used.\n","Get:1 http://packages.cloud.google.com/apt gcsfuse-focal/main amd64 gcsfuse amd64 0.41.11 [13.3 MB]\n","Fetched 13.3 MB in 0s (49.4 MB/s)\n","debconf: unable to initialize frontend: Dialog\n","debconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76, <> line 1.)\n","debconf: falling back to frontend: Readline\n","debconf: unable to initialize frontend: Readline\n","debconf: (This frontend requires a controlling tty.)\n","debconf: falling back to frontend: Teletype\n","dpkg-preconfigure: unable to re-open stdin: \n","Selecting previously unselected package gcsfuse.\n","(Reading database ... 129501 files and directories currently installed.)\n","Preparing to unpack .../gcsfuse_0.41.11_amd64.deb ...\n","Unpacking gcsfuse (0.41.11) ...\n","Setting up gcsfuse (0.41.11) ...\n","2023/01/17 21:20:28.727949 Start gcsfuse/0.41.11 (Go version go1.18.4) for app \"\" using mount point: /content/gcp_bucket\n","2023/01/17 21:20:28.744388 Opening GCS connection...\n","2023/01/17 21:20:30.192539 Mounting file system \"finlandforest\"...\n","2023/01/17 21:20:30.193437 File system has been successfully mounted.\n","/content/drive/MyDrive/finland_forest\n"]}],"source":["def mount_bucket(bucket_name):\n","  \"\"\"\n","  This fn authenticates your google account and mounts to you Google Cloud Platform bucket\n","  \"\"\"\n","  !echo \"deb http://packages.cloud.google.com/apt gcsfuse-`lsb_release -c -s` main\" | sudo tee /etc/apt/sources.list.d/gcsfuse.list\n","  !curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -\n","  !sudo apt-get -y -q update\n","  !sudo apt-get -y -q install gcsfuse\n","\n","  from google.colab import auth\n","  auth.authenticate_user()\n","  !mkdir -p gcp_bucket \n","  !gcsfuse --implicit-dirs --limit-bytes-per-sec -1 --limit-ops-per-sec -1 {bucket_name} gcp_bucket\n","\n","mount_bucket('finlandforest')\n","%cd drive/MyDrive/finland_forest/"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":325,"status":"ok","timestamp":1673990523892,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"VE9gv2I9mcCl","outputId":"d1dca1ef-6cf0-46ee-ece0-abc5266c4f5b"},"outputs":[],"source":["%load_ext autoreload\n","%autoreload 2\n","\n","# %cd drive/MyDrive/finland_forest"]},{"cell_type":"code","execution_count":2,"metadata":{"executionInfo":{"elapsed":5,"status":"ok","timestamp":1673990681258,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"VkogjfkgmhEc"},"outputs":[],"source":["import numpy as np\n","import pandas as pd\n","import rasterio\n","import matplotlib.pyplot as plt\n","from sklearn.preprocessing import minmax_scale\n","from tqdm.notebook import tqdm\n","\n","import tensorflow as tf\n","from tensorflow import data\n","\n","import warnings\n","warnings.filterwarnings(\"ignore\", category=rasterio.errors.NotGeoreferencedWarning)  # our rasters are not georeferenced\n","warnings.filterwarnings('ignore', r'All-NaN (slice|axis) encountered')\n","\n","# PATH = '/content/drive/MyDrive/finland_forest/'"]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":85398,"status":"ok","timestamp":1673991402806,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"1hMlLoOSn90s","outputId":"f8f8a762-5b0c-4373-f5ac-84e6566ebd5f"},"outputs":[{"name":"stdout","output_type":"stream","text":["6.07 s ± 58.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)\n"]}],"source":["%timeit rasterio.open('gs://finlandforest/train_features/93dd0d32_agbm.tif').read()"]},{"cell_type":"code","execution_count":4,"metadata":{},"outputs":[{"data":{"text/plain":["'2.9.3'"]},"execution_count":4,"metadata":{},"output_type":"execute_result"}],"source":["rasterio.open('/content/gcp_bucket/train_features/93dd0d32_agbm.tif').read()"]},{"cell_type":"code","execution_count":5,"metadata":{"executionInfo":{"elapsed":1321,"status":"ok","timestamp":1673991017102,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"7mkktIlsnGET"},"outputs":[],"source":["features = pd.read_csv(f'{PATH}data/features_proc.csv')\n","train_features = features[features['split'] == 'train']\n","test_features = features[features['split'] == 'test']"]},{"cell_type":"code","execution_count":7,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":424},"executionInfo":{"elapsed":372,"status":"ok","timestamp":1673991134444,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"3AzvagkgpVtV","outputId":"a0b439a3-c87c-494d-a7da-fefef70a4c62"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>filename</th>\n","      <th>chip_id</th>\n","      <th>satellite</th>\n","      <th>split</th>\n","      <th>month</th>\n","      <th>corresponding_agbm</th>\n","      <th>image_filepath</th>\n","      <th>label_filepath</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>93dd0d32_S2_07.tif</td>\n","      <td>93dd0d32</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>4</td>\n","      <td>93dd0d32_agbm.tif</td>\n","      <td>gcp_bucket/train_features/93dd0d32_S2_07.tif</td>\n","      <td>gcp_bucket/train_features/93dd0d32_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>832b55bd_S1_04.tif</td>\n","      <td>832b55bd</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>1</td>\n","      <td>832b55bd_agbm.tif</td>\n","      <td>gcp_bucket/train_features/832b55bd_S1_04.tif</td>\n","      <td>gcp_bucket/train_features/832b55bd_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>a6d62d7f_S2_00.tif</td>\n","      <td>a6d62d7f</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>9</td>\n","      <td>a6d62d7f_agbm.tif</td>\n","      <td>gcp_bucket/train_features/a6d62d7f_S2_00.tif</td>\n","      <td>gcp_bucket/train_features/a6d62d7f_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>a74d5ce1_S1_10.tif</td>\n","      <td>a74d5ce1</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>7</td>\n","      <td>a74d5ce1_agbm.tif</td>\n","      <td>gcp_bucket/train_features/a74d5ce1_S1_10.tif</td>\n","      <td>gcp_bucket/train_features/a74d5ce1_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>404571ba_S1_04.tif</td>\n","      <td>404571ba</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>1</td>\n","      <td>404571ba_agbm.tif</td>\n","      <td>gcp_bucket/train_features/404571ba_S1_04.tif</td>\n","      <td>gcp_bucket/train_features/404571ba_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>252421</th>\n","      <td>d3e6581d_S1_11.tif</td>\n","      <td>d3e6581d</td>\n","      <td>S1</td>\n","      <td>test</td>\n","      <td>8</td>\n","      <td>d3e6581d_agbm.tif</td>\n","      <td>gcp_bucket/train_features/d3e6581d_S1_11.tif</td>\n","      <td>gcp_bucket/train_features/d3e6581d_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252422</th>\n","      <td>e7535960_S1_07.tif</td>\n","      <td>e7535960</td>\n","      <td>S1</td>\n","      <td>train</td>\n","      <td>4</td>\n","      <td>e7535960_agbm.tif</td>\n","      <td>gcp_bucket/train_features/e7535960_S1_07.tif</td>\n","      <td>gcp_bucket/train_features/e7535960_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252423</th>\n","      <td>25a25054_S2_08.tif</td>\n","      <td>25a25054</td>\n","      <td>S2</td>\n","      <td>train</td>\n","      <td>5</td>\n","      <td>25a25054_agbm.tif</td>\n","      <td>gcp_bucket/train_features/25a25054_S2_08.tif</td>\n","      <td>gcp_bucket/train_features/25a25054_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252424</th>\n","      <td>508cbf2e_S2_04.tif</td>\n","      <td>508cbf2e</td>\n","      <td>S2</td>\n","      <td>test</td>\n","      <td>1</td>\n","      <td>508cbf2e_agbm.tif</td>\n","      <td>gcp_bucket/train_features/508cbf2e_S2_04.tif</td>\n","      <td>gcp_bucket/train_features/508cbf2e_agbm.tif</td>\n","    </tr>\n","    <tr>\n","      <th>252425</th>\n","      <td>d1f4c37d_S1_02.tif</td>\n","      <td>d1f4c37d</td>\n","      <td>S1</td>\n","      <td>test</td>\n","      <td>11</td>\n","      <td>d1f4c37d_agbm.tif</td>\n","      <td>gcp_bucket/train_features/d1f4c37d_S1_02.tif</td>\n","      <td>gcp_bucket/train_features/d1f4c37d_agbm.tif</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>252426 rows × 8 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-98cc0a8e-f05b-40e7-bb45-8fe1d4ce7aa7');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["                  filename   chip_id satellite  split  month  \\\n","0       93dd0d32_S2_07.tif  93dd0d32        S2  train      4   \n","1       832b55bd_S1_04.tif  832b55bd        S1  train      1   \n","2       a6d62d7f_S2_00.tif  a6d62d7f        S2   test      9   \n","3       a74d5ce1_S1_10.tif  a74d5ce1        S1  train      7   \n","4       404571ba_S1_04.tif  404571ba        S1  train      1   \n","...                    ...       ...       ...    ...    ...   \n","252421  d3e6581d_S1_11.tif  d3e6581d        S1   test      8   \n","252422  e7535960_S1_07.tif  e7535960        S1  train      4   \n","252423  25a25054_S2_08.tif  25a25054        S2  train      5   \n","252424  508cbf2e_S2_04.tif  508cbf2e        S2   test      1   \n","252425  d1f4c37d_S1_02.tif  d1f4c37d        S1   test     11   \n","\n","       corresponding_agbm                                image_filepath  \\\n","0       93dd0d32_agbm.tif  gcp_bucket/train_features/93dd0d32_S2_07.tif   \n","1       832b55bd_agbm.tif  gcp_bucket/train_features/832b55bd_S1_04.tif   \n","2       a6d62d7f_agbm.tif  gcp_bucket/train_features/a6d62d7f_S2_00.tif   \n","3       a74d5ce1_agbm.tif  gcp_bucket/train_features/a74d5ce1_S1_10.tif   \n","4       404571ba_agbm.tif  gcp_bucket/train_features/404571ba_S1_04.tif   \n","...                   ...                                           ...   \n","252421  d3e6581d_agbm.tif  gcp_bucket/train_features/d3e6581d_S1_11.tif   \n","252422  e7535960_agbm.tif  gcp_bucket/train_features/e7535960_S1_07.tif   \n","252423  25a25054_agbm.tif  gcp_bucket/train_features/25a25054_S2_08.tif   \n","252424  508cbf2e_agbm.tif  gcp_bucket/train_features/508cbf2e_S2_04.tif   \n","252425  d1f4c37d_agbm.tif  gcp_bucket/train_features/d1f4c37d_S1_02.tif   \n","\n","                                     label_filepath  \n","0       gcp_bucket/train_features/93dd0d32_agbm.tif  \n","1       gcp_bucket/train_features/832b55bd_agbm.tif  \n","2       gcp_bucket/train_features/a6d62d7f_agbm.tif  \n","3       gcp_bucket/train_features/a74d5ce1_agbm.tif  \n","4       gcp_bucket/train_features/404571ba_agbm.tif  \n","...                                             ...  \n","252421  gcp_bucket/train_features/d3e6581d_agbm.tif  \n","252422  gcp_bucket/train_features/e7535960_agbm.tif  \n","252423  gcp_bucket/train_features/25a25054_agbm.tif  \n","252424  gcp_bucket/train_features/508cbf2e_agbm.tif  \n","252425  gcp_bucket/train_features/d1f4c37d_agbm.tif  \n","\n","[252426 rows x 8 columns]"]},"execution_count":7,"metadata":{},"output_type":"execute_result"}],"source":["features"]},{"cell_type":"code","execution_count":8,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":35},"executionInfo":{"elapsed":321,"status":"ok","timestamp":1673991138190,"user":{"displayName":"graham broughton","userId":"15728648374086258761"},"user_tz":480},"id":"H-JFWKTJpZcr","outputId":"781536a8-3e05-4b2f-a109-e6a9befa2b9d"},"outputs":[{"data":{"application/vnd.google.colaboratory.intrinsic+json":{"type":"string"},"text/plain":["'/content/drive/MyDrive/finland_forest'"]},"execution_count":8,"metadata":{},"output_type":"execute_result"}],"source":["%pwd"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"rmny5wCipaZc"},"outputs":[],"source":[]}],"metadata":{"colab":{"authorship_tag":"ABX9TyOQt2g3dc3OPXvsRYF4gZ/y","mount_file_id":"1GqO1WIMUoWs77H5ieZgRTPSs3tXn93_c","provenance":[]},"kernelspec":{"display_name":"new","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.9.15"},"vscode":{"interpreter":{"hash":"64b9008e3ac84f59fe598096ba753170ef56d87c6b7c898b3dc8f256c225a33d"}}},"nbformat":4,"nbformat_minor":0}
